# 第06节：Koa基础

### 一、koa框架概述

Koa是一个基于node的web服务器开发框架，通过Koa我们可以更为便捷的开发web服务器

### 二、安装Koa

首先在项目文件夹汇总初始化项目，在cmd中输入`npm init`

然后安装相关依赖，安装Koa框架，输入`cnmp install --save koa`

### 三、创建服务器

```js
const Koa = require("koa"); // 返回的是一个koa构造函数
const app = new Koa(); // 通过new 构造函数创建app应用对象
app.listen(3000,() =>{
    console.log("your server is running");
})
```

访问本机3000端口可以看到not found，表示服务器正常启动，只是没有响应内容

通过app的use方法来设置响应的内容：

```js
const Koa = require("koa");
const app = new Koa();

//use方法内的中间件回调函数会在请求与响应之间执行
app.use(async ctx => {
    ctx.body = "hello world"
})
app.listen(3000, () => {
    console.log("your server is running")
})
```

app的use方法可以调用一个函数（中间件）且必须是async函数，这函数会在请求和响应之间被调用

函数接受两个参数：ctx和next。

* ctx：上下文变量，可以获取到请求与响应的相关信息。body属性可以设置响应内容。
* next：处理下一个异步函数

多个use方法情况：

```js
const Koa = require("koa");
const app = new Koa();

app.use(async (ctx,next) => {
    ctx.body = "hello world";
    await next();
})
app.use(async (ctx,next) => {
    console.log("我是一个中间件")
})

app.listen(3000, () => {
    console.log("your server is running")
})
```

### 四、路由

浏览器可以使用不同的方法发送请求，常用的方法有：

* get请求：用来获取页面或数据
* post请求：用来提交数据，一般登录的时候会使用

本节主要使用get请求来获取页面

首先安装第三方依赖koa-router, `cnpm install --save koa-router`

```js
const Koa = require("koa");
const router = require("koa-router")();//引入并且执行
const app = new Koa();

// get是http协议的请求方法
router.get("/", async ctx => {
    ctx.body ="<h1>home page</h1>";
})
router.get("/video", async ctx => {
    ctx.body = "<h1>video page</h1>";
})
app.use(router.routers());//在koa项目中引入router

app.listen(3000, ()=>{
    console.log("your server is runnning")
})
```

### 五、静态文件

web应用的服务器，只有静态文件目录里面的文件才可以被html页面直接访问，其他目录禁止访问。

也就是说，需要先创建一个静态文件目录，然后在里面放置图片（js或者css等）才能被html页面访问

通过第三方模块koa-static ,可以设置静态文件目录。

`cnpm install --save koa-static`

代码如下：

```js
const Koa = require("koa");
const static = require("koa-static");
const app = new Koa();
//__dirname表示当前项目的绝对路径
app.use(static(__dirname+"/public"));

app.use(async (ctx) => {
    ctx.body = `
		<h1>这是一个有图片的网页</h1>
		<img src="/img/logo.jpg">
`
})
app.listen(3000, () => {
    console.log("服务器启动")
})
```

引入koa-static,可以得到一个static函数，通过调用这个static函数，便可以将参数的目录设置为一个静态目录。

