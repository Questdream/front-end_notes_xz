# 第07节：模板引擎概述

### 一、模板引擎

上一节通过koa创建了一个web服务器，可以根据用户请求的路径返回不同的响应内容，但是都是通过字符串的方式送给浏览器，这样不好，更希望直接发送html页面。

通过**模板引擎**可以直接设置响应的HTML页面，并且把后台数据绑定到模板中，然后发送给客户端

目前市面上有很多模板引擎。这里推荐nunjucks

### 二、安装nunjucks

在koa框架下安装nunjucks需要两个第三方模块：

* koa-views：负责配置koa的模板引擎来指定哪个模板引擎 `cnpm install --save koa-views`

* nunjucks：下载模板引擎 `cnpm install --save nunjucks`

  

### 三、配置模板引擎

```js
// server.js
const Koa = require("koa");
const nunjucks = require("nunjucks");
const views = require("koa-views");
const app = new Koa();

app.use(views(__dirname + "/views", {
    //将使用nunjucks渲染以html为后缀的文件。
    map:{html:"nunjucks"}
}));
app.use(async ctx => {
    //render方法渲染模板，第二个参数可以给模板传递参数
    await ctx.render("index",{title:"这是我的第一个模板"})
})
app/listen(3000, () => {
    console.log("启动服务器")
})

<!-- views/index.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <h1>这是我的第一个模板</h1>
    <h1>{{title}}</h1>
    <form action="/login" method="POST">
        <!-- name：定义表单提交的数据字段 -->
        <input type="text" name="username">
        <input type="password" name="password">
        <input type="submit" value="登录">
    
    </form>
</body>
</html>
```

### 四、结合路由来渲染模板

前面代码使用app.use来渲染模板，现在结合路由router.get来渲染

```js
router.get("/",async (ctx,next) =>{
    await ctx.render("index",{ //即views下的index.html文件
        title:"欢迎来到德莱联盟"
    })
});
router.get("/docs",async (ctx,next) => {
    await ctx.render("data", {//即views下的data.html文件
        title:"xiaozhoubg",
        docs:"让学习更高效"
    })
})
```

### 五、处理表单数据

#### 1.概述

​	本节学习如何通过表单向后台发送数据

​	form标签的两个属性：

* action属性：指定表单提交数据的路径
* method属性：指定表单提交数据的请求方法，包括get和post请求。

​     form标签设置完成后，需要对表单空间设置

* input的name属性：指定数据传输的字段
* input的type属性为submit：指定提交按钮，点击后提交表单数据

#### 2.获取get请求和post请求的数据

​	直接通过ctx.query就可以获得get请求的数据，

​	若要获得post请求的数据，需要安装第三方模块koa-parser来解析post请求，通过ctx.request.body来获得数据。

```js
//获取get请求的参数
router.post("/login", async ctx => {
    let username = ctx.request.body.username;
    let password = ctx.request.body.password;
    await ctx.render("home",{
        username, //属性名和属性值相同可以简写为一个，不简写是username：username
        password
    })
})
router.get("/login", async ctx => {
    let username = ctx.query.username;
    let password = ctx.query.password;
    await ctx.render("home",{
        username, //属性名和属性值相同可以简写为一个，不简写是username：username
        password
    })
})
```

